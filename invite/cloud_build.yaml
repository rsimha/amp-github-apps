steps:
  # The first two steps are required to identify and inject un-redacted secrets.
  - name: gcr.io/cloud-builders/npm
    args:
      - install
      - yaml
  - name: gcr.io/cloud-builders/npm
    args:
      - run
      - replace-secrets
      - --
      - invite
    secretEnv:
      - PRIVATE_KEY
      - WEBHOOK_SECRET
      - GITHUB_ACCESS_TOKEN

  # Deploy the app
  - name: gcr.io/cloud-builders/gcloud
    dir: invite
    args:
      - functions
      - deploy
      - invite-bot
      - --entry-point
      - probot

# These secrets are the base64-encoded form of encrypted secret values. They are
# automatically decrypted and added to the `.env` environment at build time.
secrets:
  - kmsKeyName: projects/ampproject-invite-bot/locations/global/keyRings/amp-github-apps-keyring/cryptoKeys/app-env-key
    secretEnv:
      PRIVATE_KEY: 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
      WEBHOOK_SECRET: CiQArmoemo0fZuap9bam+3PDT/VDPMqTIU7eWvhkjUcwswpwzlQSOACoyAgnBU5hQNuRRbvBoU/eVVvCpsJ5WufgRLhzvg/k+jUWJb7ERoOeLW942PxDV0alCTtl/wrg
      DB_USER: CiQArmoemjvj+hM3vugn/6C2PqevTGhTI6HN3Hoiw8zgZF6V2AsSMQCoyAgnaDq+y5iZxNDNHSeRau/rDpLq7dL6opK0rt+Ytu3tpg/+0f59LRoNz+RvIhU=
      DB_PASSWORD: CiQArmoemrV+RHBPee5r9yceBfFnXkENldVkZHa7xa1yvoA2cZ0SOACoyAgng6SkhxzKhHVuyTcCA4evilwUXX2eGHj9aMPa1Z7q9F1iSyS++V365ynx6kqzimEsMlBi
